<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Safety Update 2025 Database</title>
  <!-- Loading Tailwind CSS for styling -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Loading prop-types for React -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prop-types/15.8.1/prop-types.min.js"></script>
  <!-- Loading React and ReactDOM -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <!-- Loading Babel for JSX transformation -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
  <!-- Loading PapaParse for CSV parsing -->
  <script src="https://unpkg.com/papaparse@latest/papaparse.min.js"></script>
  <!-- Loading Recharts for visualizations -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.15.0/Recharts.min.js"></script>
</head>
<body class="bg-gray-100">
  <div id="root" class="container mx-auto p-4"></div>

  <script type="text/babel">
    // Defining the main App component
    const App = () => {
      // Managing state for data, search, filters, and sorting
      const [data, setData] = React.useState([]);
      const [searchTerm, setSearchTerm] = React.useState('');
      const [reviewFilter, setReviewFilter] = React.useState('');
      const [reasonFilter, setReasonFilter] = React.useState('');
      const [sortConfig, setSortConfig] = React.useState({ key: '', direction: '' });
      const [loading, setLoading] = React.useState(true);

      // Loading and parsing CSV data
      React.useEffect(() => {
        Papa.parse(loadFileData("Safety Update 2025 1.csv"), {
          header: true,
          skipEmptyLines: true,
          transformHeader: (header) => header.trim().replace(/^"|"$/g, ''),
          transform: (value, header) => {
            let cleaned = value.trim().replace(/^"|"$/g, '');
            return cleaned;
          },
          complete: (results) => {
            const cleanedData = results.data.map(row => ({
              "Product Name": row["Product Name"] || "",
              "Active Substance": row["Active Substance"] || "",
              "Potential Safety Signal": row["Potential Safety Signal"] || "",
              "Reason to be Reviewed Category": row["Reason to be Reviewed Category"] || "",
              "Review outcome": row["Review outcome"] || ""
            }));
            setData(cleanedData);
            setLoading(false);
          },
          error: (err) => {
            console.error('Error parsing CSV:', err);
            setLoading(false);
          }
        });
      }, []);

      // Handling sorting logic
      const handleSort = (key) => {
        let direction = 'asc';
        if (sortConfig.key === key && sortConfig.direction === 'asc') {
          direction = 'desc';
        }
        setSortConfig({ key, direction });
      };

      // Sorting data based on sortConfig
      const sortedData = React.useMemo(() => {
        if (!sortConfig.key) return data;
        return [...data].sort((a, b) => {
          const aValue = a[sortConfig.key] || '';
          const bValue = b[sortConfig.key] || '';
          if (aValue < bValue) return sortConfig.direction === 'asc' ? -1 : 1;
          if (aValue > bValue) return sortConfig.direction === 'asc' ? 1 : -1;
          return 0;
        });
      }, [data, sortConfig]);

      // Filtering data based on search and filter inputs
      const filteredData = sortedData.filter(row => {
        const matchesSearch = row["Product Name"].toLowerCase().includes(searchTerm.toLowerCase()) ||
                             row["Active Substance"].toLowerCase().includes(searchTerm.toLowerCase());
        const matchesReview = reviewFilter ? row["Review outcome"] === reviewFilter : true;
        const matchesReason = reasonFilter ? row["Reason to be Reviewed Category"] === reasonFilter : true;
        return matchesSearch && matchesReview && matchesReason;
      });

      // Preparing data for visualizations
      const reviewOutcomeCounts = data.reduce((acc, row) => {
        const outcome = row["Review outcome"] || "Unknown";
        acc[outcome] = (acc[outcome] || 0) + 1;
        return acc;
      }, {});
      const reviewOutcomeData = Object.entries(reviewOutcomeCounts).map(([name, value]) => ({ name, value }));

      const reasonCategoryCounts = data.reduce((acc, row) => {
        const category = row["Reason to be Reviewed Category"] || "Unknown";
        acc[category] = (acc[category] || 0) + 1;
        return acc;
      }, {});
      const reasonCategoryData = Object.entries(reasonCategoryCounts).map(([name, value]) => ({ name, value }));

      // Rendering loading message if data is not yet loaded
      if (loading) {
        return <div className="text-center text-xl mt-10">Loading data...</div>;
      }

      // Rendering the main interface
      return (
        <div className="bg-white p-6 rounded-lg shadow-lg">
          <h1 className="text-3xl font-bold mb-4 text-center">Safety Update 2025 Database</h1>

          {/* Adding search and filter controls */}
          <div className="mb-6 flex flex-col md:flex-row gap-4">
            <input
              type="text"
              placeholder="Search by Product Name or Active Substance"
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
              className="p-2 border rounded w-full md:w-1/3"
            />
            <select
              value={reviewFilter}
              onChange={(e) => setReviewFilter(e.target.value)}
              className="p-2 border rounded w-full md:w-1/3"
            >
              <option value="">Filter by Review Outcome</option>
              {[...new Set(data.map(row => row["Review outcome"]))].map(outcome => (
                <option key={outcome} value={outcome}>{outcome}</option>
              ))}
            </select>
            <select
              value={reasonFilter}
              onChange={(e) => setReasonFilter(e.target.value)}
              className="p-2 border rounded w-full md:w-1/3"
            >
              <option value="">Filter by Reason Category</option>
              {[...new Set(data.map(row => row["Reason to be Reviewed Category"]))].map(category => (
                <option key={category} value={category}>{category}</option>
              ))}
            </select>
          </div>

          {/* Displaying interesting fact */}
          <div className="mb-6 p-4 bg-blue-100 rounded-lg">
            <h2 className="text-xl font-semibold">Interesting Fact</h2>
            <p>
              The most common safety signal is <strong>"Propylene glycol safety during pregnancy and in neonates"</strong>,
              appearing in {reasonCategoryCounts["Safety in special population"]} entries, highlighting significant concerns
              about the use of certain medications in pregnant women and neonates.
            </p>
          </div>

          {/* Displaying visualizations */}
          <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <div>
              <h2 className="text-xl font-semibold mb-2">Review Outcome Distribution</h2>
              <Recharts.ResponsiveContainer width="100%" height={300}>
                <Recharts.BarChart data={reviewOutcomeData}>
                  <Recharts.CartesianGrid strokeDasharray="3 3" />
                  <Recharts.XAxis dataKey="name" angle={-45} textAnchor="end" fontSize={12} />
                  <Recharts.YAxis fontSize={12} />
                  <Recharts.Tooltip />
                  <Recharts.Legend />
                  <Recharts.Bar dataKey="value" fill="#3B82F6" />
                </Recharts.BarChart>
              </Recharts.ResponsiveContainer>
            </div>
            <div>
              <h2 className="text-xl font-semibold mb-2">Reason Category Distribution</h2>
              <Recharts.ResponsiveContainer width="100%" height={300}>
                <Recharts.BarChart data={reasonCategoryData}>
                  <Recharts.CartesianGrid strokeDasharray="3 3" />
                  <Recharts.XAxis dataKey="name" angle={-45} textAnchor="end" fontSize={12} />
                  <Recharts.YAxis fontSize={12} />
                  <Recharts.Tooltip />
                  <Recharts.Legend />
                  <Recharts.Bar dataKey="value" fill="#10B981" />
                </Recharts.BarChart>
              </Recharts.ResponsiveContainer>
            </div>
          </div>

          {/* Displaying the data table with sortable headers */}
          <div className="overflow-x-auto">
            <table className="w-full border-collapse">
              <thead>
                <tr className="bg-gray-200">
                  {['Product Name', 'Active Substance', 'Potential Safety Signal', 'Reason to be Reviewed Category', 'Review outcome'].map(key => (
                    <th
                      key={key}
                      className="p-2 border cursor-pointer hover:bg-gray-300"
                      onClick={() => handleSort(key)}
                    >
                      {key} {sortConfig.key === key ? (sortConfig.direction === 'asc' ? '↑' : '↓') : ''}
                    </th>
                  ))}
                </tr>
              </thead>
              <tbody>
                {filteredData.map((row, index) => (
                  <tr key={index} className={index % 2 === 0 ? 'bg-gray-50' : 'bg-white'}>
                    <td className="p-2 border">{row["Product Name"]}</td>
                    <td className="p-2 border">{row["Active Substance"]}</td>
                    <td className="p-2 border">{row["Potential Safety Signal"]}</td>
                    <td className="p-2 border">{row["Reason to be Reviewed Category"]}</td>
                    <td className="p-2 border">{row["Review outcome"]}</td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      );
    };

    // Rendering the App component
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
